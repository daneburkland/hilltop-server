generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-1.1.x"]
}

datasource db {
  provider = "postgresql"
  url = "***"
}

model Run {
  id             Int      @default(autoincrement()) @id
  test           Test     @relation(fields: [testId], references: [id])
  testId         Int
  result         String
  createdAt      DateTime @default(now())
  logs           Log[]
  screenshotUrls String[]
}

model Test {
  id        Int      @default(autoincrement()) @id
  title     String
  author    User?    @relation(fields: [authorId], references: [id])
  authorId  String?
  code      String
  runs      Run[]
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now())
}

model User {
  id     String  @id
  email  String  @unique
  name   String?
  tests  Test[]
  apiKey ApiKey?
  team   Team    @relation(fields: [teamId], references: [id])
  teamId Int
}

model Team {
  id      Int    @id
  name    String
  members User[]
}

model ApiKey {
  hashed String @unique
  prefix String
  user   User   @relation(fields: [userId], references: [id])
  userId String @unique
}

model Log {
  id       Int      @default(autoincrement()) @id
  run      Run      @relation(fields: [runId], references: [id])
  runId    Int
  level    Int
  time     DateTime
  pid      Int
  hostname String
  msg      String
  stack    String?
}
